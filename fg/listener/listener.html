<!DOCTYPE html>

<html>
  <head>
	
	<meta charset="utf-8" http-equiv="Content-Security-Policy" content="script-src 'self' * 'unsafe-eval'; object-src 'self';">
	<!-- <meta charset="utf-8"> -->
	
	<link rel="stylesheet" href="chrome://browser/content/extension.css">
	<link rel="stylesheet" href="../deps/json/json-formatter.css">
	<link rel="stylesheet" href="listener.css">

	<script src="../deps/jquery.min.js"></script>
	<script src="../deps/angular.min.js"></script>
	
	<script src="../../utils/jsloader-utils.js" type="text/javascript" charset="utf-8"></script>

	<script src="../deps/highlightjs/highlight.min.js"></script>
	<script src="../deps/angular-highlightjs-searchtext/build/release/angular-highlightjs-searchtext.min.js"></script>
	<script src="../partials/partials.js"></script>
	<script src="../../utils/deps/EventEmitter/EventEmitter.min.js"></script>
	
  </head>
  
  <body spellcheck=false ng-controller="bodyController as listener" ng-cloak>
	
	<div id="listener-header" class="panel-section panel-section-header header">

	  <div class="header-title text-section-header">
		<div class="header-title-text"> {{label}} || 
		  <span>
			<bdi id="listening_to"> Listening to tab <strong> {{ tabId }} </strong> </bdi>
		  </span>
		</div>
		<button class="browser-style jslbtn" ng-click="toggleCapture()"> {{ capture_status }} capture </button>
	  </div>
	  
	  <div class="filter-bucket">

		<div class="filter-list">
		  
		  <label ng-repeat="filter in filterOpts track by filter.text" class="filter-label">
			<input type="checkbox" ng-model="filter.value" ng-change="filter.change(filter.value)">
			<span> {{ filter.text }} </span>
		  </label>
		  
		</div>
		
		<span class="filter-label"> Filter: </span>
		<input class="filter_inpt browser-style" type="text" ng-model="advFilter" ng-change="advFilterChange()">
		
		<span class="filter-label"> Proxy: </span>
		<select class="browser-style" ng-model="currentProxy" ng-options="proxy for proxy in proxys" ng-change="proxyChange()"></select>
		
	  </div>
	</div>
	
	<div id="content" class="panel-section scrollable" ng-controller="listenerController as listener">
	  <no-info ng-if="!infoShown()"></no-info>

	  <ul style="display:block;">
		  
		<li ng-repeat="req in list" ng-show="req.shown">
		  
		  <json-formatter json="req.request" open="1" ng-click="req.toggleList($event)" urlclick="urlClick" style="display:block;"></json-formatter><br>
		  <json-formatter json="req.responses" open="0" ng-show="req.visible" urlclick="urlClick" style="display:block;"></json-formatter><br ng-show="req.visible">
		  
		  <button class="browser-style" ng-show="req.visible && !req.adding" ng-click="showRuleAdder(req)"> Add rule </button>
		  <rule-adder style="display: inline-block;" req="req" ng-show="req.visible && req.adding"></rule-adder>

		  <div ng-show="req.visible && req.rules.length" class="rule-remover">
			<span class="filter-label"> Matching rules: </span>
			<select class="browser-style" ng-model="req.currentRule" ng-options="rule.id for rule in req.rules"></select>
			<button class="browser-style" ng-click="removeRule(req)"> Remove </button>
			<button class="browser-style" ng-click="toggleRule(req)"> {{ req.ruleStatus() }} </button>
		  </div>
		  
		  <hr ng-show="req.visible"><br ng-show="req.visible">
		  
		</li>
		<li class="buttons-landing">
		  <a id="bottom"></a>
		</li>
	  </ul>
	  
	  <div class="button-bucket">
		<button class="browser-style" ng-show="infoShown()" ng-click="flushRequests()"> Flush {{ btnStatus() }} </button>
		<button class="browser-style" ng-show="infoShown()" ng-click="downloadCapture()"> Download {{ btnStatus() }} </button> 
		<button class="browser-style" ng-show="noBlocked()" ng-click="un_blockSelection()"> Block {{ btnStatus() }} </button>
		<button class="browser-style" ng-show="noUnblocked()" ng-click="un_blockSelection()"> Unblock {{ btnStatus() }} </button>
	  </div>
	</div>
	
	<script src="../deps/json/json-formatter.js"></script>
	<script src="listener.js"></script>
	
  </body>
</html>
